{% extends 'base.html' %}

{% load static %}

{% block title %}Cake Store Detail{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/storeDetail.css' %}" type="text/css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script type="text/javascript" src="/static/js/marketLocation.js"></script>
<script src="//developers.kakao.com/sdk/js/kakao.min.js"></script>
<script defer src="/static/js/rating.js"></script>
<!--ì§€ë„ ê¹¨ì§ ë°©ì§€ ìœ„í•œ jquery api ì¶”ê°€-->
<!--head ì¤‘ë³µ ì²˜ë¦¬ í–ˆìŠµë‹ˆë‹¤-->
{% endblock %}

{% block script %}
<!-- ì¢‹ì•„ìš” -->
<script type="text/javascript">
    csrf_token = '{{csrf_token}}';
    like_url = '{% url "like" %}';
</script>
<script src="{% static 'js/like.js' %}" type="text/javascript"></script>
{% endblock %}

{% block content %}

<body id="mainBody" onload="ì—´ê¸°('{{num}}')"
    style="background-image:url('../static/css/images/overlay.png');background-repeat: no-repeat; background-size: 100%;">

    <!-- ëŒ€í‘œì´ë¯¸ì§€, ê°€ê²Œì´ë¦„, ìœ„ì¹˜, ì—°ë½ì²˜, ì„¤ëª…, ì¼€ìŒì´ë¯¸ì§€ -->


    <div class="store-detail" style="padding-top:0px;flex-direction: column; justify-content: center;">
        <!-- <div class="store-image" style="padding: 0 43%">
            <img src="{{store.store_image.url}}" style="display: flex; flex:auto ; width:250px ; height: 250px;">
        </div> -->

        <div class="store-text"
            style="flex-direction: row; width: 100%; justify-content: center; padding: 2% 30% 0px 30%;text-align: center;">

            <div class="store-name" style="color: black; text-align: center;margin:0px auto ;">
                <div style=" padding: 5% 10% 10% 10%; ">
                    <img src="{{store.store_image.url}}" style="width:75% ; height: 750%; border-radius: 10px; border:rgba(255, 245, 238, 0.733) 4px solid;">
                </div>
                {{store.name}}
                {% if not user.is_authenticated %}
                <button class="like" style=" margin-left: 3px; height: 35px; border-color: rgb(101, 100, 100);"
                    onclick="NeedLogin()"><i class="fas fa-heart"></i></button>
                {% else %}
                {% if user in cake.users_liked.all %}
                <button class="like red" style=" margin-left: 3px; height: 35px; border:solid; border-color: lightray;"
                    id="cake{{cake.id}}" onclick="LikeIt(1, {{cake.id}})"><i class="fas fa-heart"></i></button>
                {% else %}
                <button class="like" style=" margin-left: 3px; height: 35px; border-color: rgb(101, 100, 100);"
                    id="cake{{cake.id}}" onclick="LikeIt(1, {{cake.id}})"><i class="fas fa-heart"></i></button>
                {% endif %}
                {% endif %}
                <!-- ì¢‹ì•„ìš”íƒ€ì… ì¼€ì´í¬(1)ë¡œ -->
                <!-- ìœ ì €ê°€ ì´ë¯¸ ì¢‹ì•„ìš” í•œ ê²½ìš°ì—ëŠ” ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë– ì•¼ í•¨. ifë¬¸ í™œìš© -->

            </div>
            <span class="store-contact">ğŸ“ ì—°ë½ì²˜ : {{store.contact}}</span>
            <section class="store-contact">ğŸ“ ê°€ê²Œ ìœ„ì¹˜ : {{store.locationSi}}ì‹œ {{store.locationGu}} </section>
            <section class="store-des" style="text-align: center;">#
                <!--í…ìŠ¤íŠ¸ë¥¼ í•´ì‰¬íƒœê·¸ ì²˜ëŸ¼ ë³´ì´ê²Œ í•˜ë ¤ê³ .. ê°ì„±ìˆê²Œ ìˆ˜ì •í•¨..-->
                {% for i in store.text %}
                {{i}}
                {% if i == " " %}
                #{{i}}
                {% endif %}
                {% endfor %}

            </section>
            <p id="maplat" style="display: none;">{{store.lat}}</p>
            <p id="maplon" style="display: none;">{{store.lon}}</p>
            <p class="only-owner-can-see" style="margin-top: 10px; margin-bottom: 10px;">
                <!-- ì´í•˜ ìˆ˜ì •ì€ ê°€ê²Œ ê´€ë¦¬ìë§Œ ìˆ˜ì • ë° ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•  ì˜ˆì • -->
                <!-- store.ownerë¥¼ í™•ì¸í•˜ë©´ ë¨. ë¡œê·¸ì¸í•œ ìœ ì €ì´ê³  ownerì´ë©´ ë‚´ìš© í‘œì¶œ-->
                {% if user.is_authenticated %}
                {% if store.owner == user %}
                <a href="{% url 'store_edit' pk=store.pk %}"><button class="edit-button">ì •ë³´ ìˆ˜ì •</button></a>
                <!-- ì‚¬ì¥ì€ ê°€ê²Œ í˜ì´ì§€ì—ì„œ ì •ë³´ ìˆ˜ì • ë° ì¼€ì´í¬ ìƒì„±, ìˆ˜ì •í•  ìˆ˜ ìˆìŒ. ë‹¤ë§Œ ê°€ê²Œ ì „ì²´ ê´€ë¦¬í˜ì´ì§€ê°€ í•„ìš”í• ë“¯! -->

                {% if not store.store_menu %}
                <a href="{% url 'storemenu' store_pk=store.pk %}"><button class="edit-button">ë©”ë‰´ ì¶”ê°€</button></a>
                {% else %}
                <a href="{% url 'cake_new' pk=store.pk %}"><button class="edit-button">ì¼€ì´í¬ ì¶”ê°€</button></a>
                <a href="{% url 'storemenu_edit' store_pk=store.pk %}"><button class="edit-button">ë©”ë‰´ ìˆ˜ì •</button></a>
                {% endif %}
                {% endif %}
                {% endif %}
            </p>
        </div>
    </div>


    <div class="option-box">
        <div class="option-box-block" style="display: flex; flex: auto; text-align: center; align-content: center;">
            <!--ë²„íŠ¼ width ì— min width ì„¤ì •ë˜ì–´ ìˆì–´ì„œ íë¥´ëŠ” í˜„ìƒ ë°œìƒí–ˆìŒ~ ì´ê±° ì—†ì• ì£¼ê¸° ìœ„í•´ ìŠ¤íƒ€ì¼ ì ìš©í–ˆìœ¼ë‹ˆ accept change í•˜ë¯„ë¼-->
            <div class="buttons" style="min-width: 0px; display: flex; flex: auto; width: auto; align-items: center;">
                <input type="button" class="ì—´ê¸°í˜¸ë²„" onclick="ì—´ê¸°(0)" value="ë©” ë‰´"
                    style="color:black;min-width: 0px; display: flex; flex: auto; width: auto;justify-content: center;"></input>


                <!--FE: buttonì„ inputìœ¼ë¡œ ë³€ê²½í•¨!-->
                <input type="button" class="ì—´ê¸°í˜¸ë²„" onclick="ì—´ê¸°(1); relayout();" value="ì • ë³´"
                    style="color:black;min-width: 0px; display: flex; flex: auto; width: auto;justify-content: center;"></input>
                <!---->
                <!--relayout() í•¨ìˆ˜ ì¶”ê°€í•´ì„œ ì§€ë„ ê¹¨ì§ ë°©ì§€-->

                <input type="button" class="ì—´ê¸°í˜¸ë²„" onclick="ì—´ê¸°(2)" value="ë¦¬ ë·°"
                    style="color:black;min-width: 0px; display: flex; flex: auto; width: auto;justify-content: center;"></input>
            </div>
        </div>
        <!-- ì „ì²´ ì¼€ì´í¬ ë¦¬ìŠ¤íŠ¸ -->
        <div class="items">
            <!--ë²„íŠ¼ ëˆ„ë¥´ë©´ ë‚˜ì˜¤ëŠ” ì„¤ëª…ê¹Œì§€ í•˜ë‚˜ì˜ divì— ë¬¶ê¸°-->
            <br><br>
            <p class="items-header">ğŸ“ "{{store.name}}"ì˜ ëª¨ë“  ì¼€ì´í¬</p>

            {% for cake in cakelist %}

            <div class="cake-item">
                <div class="cake-img">
                    <a href="{% url 'cake_detail' pk=cake.pk %}"><img src="{{cake.cake_image.url}}" width="210px"
                            height="207px"></a><br>

                    <!-- ì¼€ì´í¬ ìˆ˜ì • ë²„íŠ¼ ì§€ì› ìŒ -->
                    <!-- í´ë¦­ ì‹œ ìì„¸íˆë³´ê¸°ë¡œ ë“¤ì–´ê°. -->
                    <br>

                </div>


                <div class="cake-body">
                    <p class="cake-name" style="display:flex; flex: auto;">{{cake.cakename}}
                        {% if user in cake.users_liked.all %}
                        <button class="like red" style=" margin-left: 2%; height: 35px;" id="cake{{cake.id}}"
                            onclick="LikeIt(1, {{cake.id}})"><i class="fas fa-heart"></i></button>
                        {% else %}
                        <button class="like" style=" margin-left: 2%; height: 35px;" id="cake{{cake.id}}"
                            onclick="LikeIt(1, {{cake.id}})"><i class="fas fa-heart"></i></button>
                        {% endif %}
                        <!-- ì¢‹ì•„ìš”íƒ€ì… ì¼€ì´í¬(1)ë¡œ -->
                        <!-- ìœ ì €ê°€ ì´ë¯¸ ì¢‹ì•„ìš” í•œ ê²½ìš°ì—ëŠ” ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë– ì•¼ í•¨. ifë¬¸ í™œìš© -->

                    </p>
                    <hr>
                    <p class="cake-detail">{{cake.body}}</p>

                    <section>
                        <a href="{% url 'order_submit' cake_pk=cake.pk  %}" class="order-button">ì£¼ë¬¸</a>
                        {% if user.is_authenticated %}
                        {% if store.owner == user %}
                        <a href="{% url 'cake_edit' pk=cake.pk  %}" class="order-button">ì¼€ì´í¬ ìˆ˜ì •</a>
                        {% endif %}
                        {% endif %}
                        {% if not user.is_authenticated %}
                        <button class="like" onclick="NeedLogin()"><i class="fas fa-heart"></i></button>
                        {% else %}

                        {% if user in cake.users_liked.all %}
                        <button class="like red" id="cake{{cake.id}}" onclick="LikeIt(1, {{cake.id}})"><i
                                class="fas fa-heart"></i></button>
                        {% else %}
                        <button class="like" id="cake{{cake.id}}" onclick="LikeIt(1, {{cake.id}})"><i
                                class="fas fa-heart"></i></button>
                        {% endif %}

                        {% endif %}
                        </p>
                </div>
                </a><br>
            </div>
            {% endfor %}

        </div>

        <!--ë‘ ë²ˆì§¸ ë²„íŠ¼, ì •ë³´ ëˆ„ë¥´ë©´ ë‚˜ì˜¤ëŠ” í™”ë©´-->
        <div class="items">
            <div class="info-box1">
                <p class="store-address"> â–¶ï¸ ì£¼ì†Œ : ì£¼ì†Œ(ìƒì„¸ì£¼ì†Œ) ë°›ì•„ì™€ì•¼ í•¨</p>
                <p class="store-bhour"> â–¶ï¸ ì˜ì—… ì‹œê°„ : ì˜ì—… ì‹œê°„ ë°›ì•„ì™€ì•¼ í•¨</p>
                <p class="store-contact"> â–¶ï¸ ì—°ë½ì²˜ : {{store.contact}}</p>
            </div>

            <p class="items-header">ğŸ“ ê³µì§€ì‚¬í•­</p>
            <hr class="underToday">
            <div class="info-box1">
                <p class="store-main-info"> â–¶ï¸ ê³µì§€ì‚¬í•­ ë°›ì„ ìˆ˜ ìˆë‹¤ë©´ ë°›ì•„ì˜¤ê¸°! </p>
            </div>


            <p class="items-header">ğŸ“ ì§€ë„</p>

            <!--FE: ì§€ë„ ìƒê°ë³´ë‹¤ ë§ì´ ê¹¨ì ¸ì„œ í•œ ë²ˆ ë´ì•¼í•  ë“¯! => ìˆ˜ì •í–ˆìŠµë‹ˆë‹¹! -->

            <hr class="underToday">
            <div class="info-box1">

                <p class="mapsize">
                    <div id="map" style="width:100%;height:350px;"></div>
                </p>

                <script type="text/javascript" map_api_key=settings.KAKAO_MAP_API_KEY
                    src="//dapi.kakao.com/v2/maps/sdk.js?appkey={map_api_key}"></script>
                <!--map_api í‚¤ ë³´ì•ˆì²˜ë¦¬ í–ˆìŠµë‹ˆë‹¹-->
                <script>
                    var storeName = document.getElementsByClassName("store-name");
                    //var maplat = parseInt(document.getElementById('maplat')); // ì§€ë„ë¥¼ í‘œì‹œí•  ìœ„ë„
                    var maplat = parseFloat((document.getElementById('maplat')).innerText); // ì§€ë„ë¥¼ í‘œì‹œí•  ìœ„ë„
                    //var maplon = parseInt(document.getElementById('maplon')); // ì§€ë„ë¥¼ í‘œì‹œí•  ê²½ë„
                    var maplon = parseFloat((document.getElementById('maplon')).innerText); // ì§€ë„ë¥¼ í‘œì‹œí•  ê²½ë„
                    console.log(maplat);
                    console.log(maplon);
                    //console.log((parseInt(maplat)));
                    //console.log((parseInt(maplon)));                     
                    //maplon=parseInt(maplon);
                    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
                        mapOption = {
                            center: new kakao.maps.LatLng(maplat, maplon),
                            //center: new kakao.maps.LatLng(maplat.maplon), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                            // ë‹¤ë§Œ maplat, maplon ë³€ìˆ˜ê°€ ì—¬ê¸°ì— ì „ë‹¬ë˜ë©´ ì§€ë„ê°€ ê¹¨ì§€ëŠ” í˜„ìƒ ë°œìƒ => ìˆ˜ì •í•´ ë‚˜ê°ˆ ì˜ˆì •!
                            level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
                        };
                    //36.111599999,127.44999919950 & 37.558507, 126.9474058
                    function setCenter() {
                        // ì´ë™í•  ìœ„ë„ ê²½ë„ ìœ„ì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ 
                        var moveLatLon = new kakao.maps.LatLng(maplat, maplon);

                        // ì§€ë„ ì¤‘ì‹¬ì„ ì´ë™ ì‹œí‚µë‹ˆë‹¤
                        map.setCenter(moveLatLon);
                    }
                    var map = new kakao.maps.Map(mapContainer, mapOption);

                    // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤ 
                    var markerPosition = new kakao.maps.LatLng(maplat,
                    maplon); //maplat, maplon ë³€ìˆ˜ê°€ ì—¬ê¸°ì— ì „ë‹¬ë˜ë©´ ì§€ë„ê°€ ê¹¨ì§€ëŠ” í˜„ìƒ ë°œìƒ

                    // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                    var marker = new kakao.maps.Marker({
                        position: markerPosition
                    });

                    // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
                    marker.setMap(map);
                    var markerPosition = marker.getPosition();

                    var iwContent =
                        '<div style="padding:5px;">{{store.name}}<br><a href="https://map.kakao.com/link/map/{{store.name}},{{store.lat}},{{store.lon}}"  target="_blank">í°ì§€ë„ë³´ê¸°</a><a href="https://map.kakao.com/link/to/Hello World!,{{store.lat}},{{store.lon}} target="_blank">ê¸¸ì°¾ê¸°</a></div>',
                        // ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë  ë‚´ìš©ìœ¼ë¡œ HTML ë¬¸ìì—´ì´ë‚˜ document elementê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
                        iwPosition = new kakao.maps.LatLng(maplat, maplon); //ì¸í¬ìœˆë„ìš° í‘œì‹œ ìœ„ì¹˜ì…ë‹ˆë‹¤

                    // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                    var infowindow = new kakao.maps.InfoWindow({
                        position: iwPosition,
                        content: iwContent,

                    });

                    // ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ë‘ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ markerë¥¼ ë„£ì–´ì£¼ì§€ ì•Šìœ¼ë©´ ì§€ë„ ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
                    infowindow.open(map, marker);

                    function relayout() {
                        map.relayout();
                    } // ì§€ë„ í¬ê¸° ë³€ê²½ ì‹œ ì¡°ì •í•´ì£¼ëŠ” í•¨ìˆ˜ ì¶”ê°€
                </script>
            </div>
        </div>

        <!-- ë¦¬ë·°  -->
        <!-- FE: ë‚˜ì¤‘ì—ëŠ” ë¦¬ë·° ì“´ ì‚¬ëŒ ì•„ì´ë””ë„ ë°›ì•„ì˜¬ ìˆ˜ ìˆê²Œ!  -->
        <!-- FE: ë³„ì  ë†’ì€ ìˆœ / ë‚®ì€ ìˆœ ì ìš©!  -->
        <div class="items">
            <form method="POST" class="post-form" enctype="multipart/form-data">
                {% csrf_token %}
                <select name="sort" id="_sort" onchange="this.form.submit()">
                    <option class="date" value="date">ìµœì‹ ìˆœ</option>
                    <option class="highrate" value="highrate">ë³„ì  ë†’ì€ìˆœ</option>
                    <option class="lowrate" value="lowrate">ë³„ì  ë‚®ì€ìˆœ</option>
                </select>
            </form>
            <div class="store-review">
                {% for review in reviewlist %}
                <div class="review-item">
                    <div class="review-item1">
                        <div class="review-item1-cake">
                            <p class="review-cake">{{review.order.referred_store.cakename}}</p>
                            <div class="review-star">
                                <span class="fa fa-star fa-lg checked"></span>
                                <span class="fa fa-star fa-lg {% if review.rate > 1 %} checked {% endif %}"></span>
                                <span class="fa fa-star fa-lg {% if review.rate > 2 %} checked {% endif %}"></span>
                                <span class="fa fa-star fa-lg {% if review.rate > 3 %} checked {% endif %}"></span>
                                <span class="fa fa-star fa-lg {% if review.rate > 4 %} checked {% endif %}"></span>
                            </div>
                        </div>

                        <div class="review-item1-user">
                            <p class="review-id">{{review.user.nickname}}</p>
                            <p class="review-date"> [ {{review.pub_date}} ]</p>
                        </div>
                    </div>




                    <div class="review-item2">
                        <p class="review-item2-contents">{{review.comment}}</p>
                    </div>

                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</body>


</html>
{% endblock %}