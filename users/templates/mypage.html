{% load static %}

<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <!--ë¶€íŠ¸ìŠ¤íŠ¸ë© ë¶ˆëŸ¬ì˜¨ ê²ƒ-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Allcakes Mypage</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/base.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/main.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static '/css/rating.css'%}">
    <link rel="stylesheet" href="{% static 'css/mypagenew.css' %}" type="text/css">
    <script defer src="/static/js/rating.js"></script>
</head>

<body class="mypage-body">
    <header>
        <nav class="navbar fixed-top navbar-expand-lg navbar-light" style="background-color: white;">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">ALLCAKES</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <!-- ê°€ê²Œ ìƒì„¸ì •ë³´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ ì„ì‹œë¡œ ë§í¬ ë‹¬ì•„ ë‘”ê±°ê³  -->
                        <!-- ë¦¬ë·°ëŠ” ë§ˆì´í˜ì´ì§€ ì°¸ê³  -->
						<li class="nav-item ">
                            <a class="nav-link px-2" href="{% url 'stores_all' %}">Stores</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link px-2" href="{% url 'cakes_all' %}">Cakes</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link px-2" href="#">Reviews</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link px-2" href="{% url 'search_all' %}">Search</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <!--ë¡œê·¸ì¸ or ë¡œê·¸ì•„ì›ƒ-->
                        <li class="nav-item">
                            {% if user.is_authenticated %}
                            {% if user.is_kakao == True %}
                            <!-- ì¸ì¦ëœ ìƒíƒœì—ì„œ ì¹´ì¹´ì˜¤ì¸ ê²½ìš°, ì•„ë‹Œ ê²½ìš°-->
                            <a class="nav-link px-2" href="{% url 'logout_with_kakao' %}">Logout</a>
                            {% else %}
                            <a class="nav-link px-2" href="{% url 'logout' %}">Logout</a>
                            {% endif %}

                            {% else %}
                            <!-- ì¸ì¦ë˜ì§€ ì•Šì€ ìƒíƒœë©´ ë¡œê·¸ì¸(ê°€ì…) ë§í¬ -->
                            <a class="nav-link px-2" href="{% url 'login_home' %}">Login</a>
                            {% endif %}
                        </li>
                        <!--ë¡œê·¸ì¸ê³¼ ë¡œê·¸ì•„ì›ƒë§Œ ëœ¸ -->

                        <!--ë§ˆì´í˜ì´ì§€ or about us-->
                        <li class="nav-item">

                            {% if user.is_authenticated %}
                            <!-- ìœ ì €ê°€ ë¡œê·¸ì¸ ìƒíƒœì´ë©´ ìƒë‹¨ì— ëœ¨ê³  í´ë¦­ ì‹œ ìœ ì € pkì „ë‹¬ -->
                            <a class="nav-link px-2" href="{% url 'mypage' user_pk=user.pk %}">My Page</a>
                            {% endif %}

                            {% if not user.is_authenticated %}
                            <a class="nav-link px-2" href="#">About Us</a>
                        {% endif %}
                            <!--âœ…ì„ì‹œë¡œ ë„£ìŒ! ë§í¬ëŠ” ì—°ê²° ì•ˆ í–ˆìŒ, ë“¤ì–´ê°ˆ í˜ì´ì§€ ìƒê°í•´ë´ì•¼í•¨-->

                        <!--ìœ„ì¹˜ ê²€ìƒ‰ í•„í„°ìš© ê²€ìƒ‰ì°½ => ì–´ë””ì— ë°°ì¹˜í•  ì§€ ì˜ë…¼ í•„ìš”!-->
                        </li>
                        <!--
                        <li class="nav-item">
                        ê²€ìƒ‰ ê°€ê¹Œìš´ìˆœì •ë ¬ ì‚­ì œ
                            <form action="{% url 'search' %}" method="GET" class="d-flex">
                                ì´ìœ ëŠ” ëª¨ë¥´ê² ëŠ”ë° headì— styleíƒœê·¸ ë„£ì–´ì„œ ê²€ìƒ‰ë°” í¬ê¸° ì¡°ì ˆí•˜ë©´ ì ìš©ì´ ì•ˆë˜ì–´ì„œ input íƒœê·¸ì— ìŠ¤íƒ€ì¼ ì§‘ì–´ë„£ìŒ
                                <input class="form-control me-2" type="text" placeholder="Search" aria-label="Search" name="q"
                                    style="width: 200px; height: 30px; margin-top: 5px; font-family: 'SF_HambakSnow'; border-radius: 0%; border-color: black;">
                                <button class="btn btn-secondary btn-sm" type="submit" value="r">ğŸ”</button>
                            </form>
                        </li>   
					</ul>
                -->


                    

                </div>
            </div>
        </nav>
    </header>

<!-- ì „ë‹¬ëœ ê°’ì€ user_pkê°’(user_pk), ìµœê·¼ ë¦¬ë·° 4ê°œ(reviews), ì§„í–‰ ì£¼ë¬¸ì •ë³´ ëª¨ë‘(orders), ì¼€ì´í¬ ì°œ4ê°œ(liked_cakes), ê°€ê²Œ ì°œ 4ê°œ(liked_stores) -->
<!-- ë¡œê·¸ì¸ëœ ìœ ì €ì™€ urlì† pkê°€ ë‹¤ë¥´ë©´ ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ -->
{% if user.pk != user_pk %}
    <h1> ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤ (Allcakes)</h1>

{% else %}
<!-- ëª¨ë“  ì •ë³´ê°€ ë“¤ì–´ê°€ëŠ” ê³³ O -->
    <div class = "body3">
        <div class="user-info">
            <div class="user-info-text">
                <h2> ê³ ê° ì •ë³´ </h2>
                <a href="{% url 'edit_nickname' %}"><button>ìˆ˜ì •</button></a>
                <a href="{% url 'delete_user' user_pk=user.pk %}"><button>íƒˆí‡´</button></a>
            </div>
            <img src="{% static 'img/allcake_whitecake.png' %}">
            <div class="users-detail">
                <!-- ì¼ë°˜ ë¡œê·¸ì¸ ì‹œ email ì •ë³´, ë‹‰ë„¤ì„ ì •ë³´ê°€ ìˆê³  
                ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì‹œ email, ë‹‰ë„¤ì„, ì„ íƒì ìœ¼ë¡œ ìƒì¼, ì„±ë³„, ì—°ë ¹ëŒ€ê°€ ìˆìŒ 
                ë‚¨ìì¸ì§€, ë‚´ ìƒì¼ì´ ì–¸ì œì¸ì§€, ì—°ë ¹ëŒ€ëŠ” ì–´ë””ì¸ì§€ëŠ” ìœ ì €ì—ê²Œ ë³´ê³  ì‹¶ì€ ì •ë³´ê°€ ì•„ë‹˜. 
                ë‹‰ë„¤ì„ë§Œ ë³´ì—¬ì£¼ê³  ì •ë³´ ìˆ˜ì • ëˆŒë €ì„ ë•Œ ë‹‰ë„¤ì„ë§Œ ìˆ˜ì •í•˜ë„ë¡ í•˜ê¸°. (ë‚˜ë¨¸ì§€ëŠ” ì¹´ì¹´ì˜¤ ë™ì˜ ì² íšŒë¡œ êµ¬í˜„)  -->
                <div class="user-info-text">
                    <p>ë‹‰ë„¤ì„: {{user.nickname}}</p>
                </div>
            </div>
        </div>
        <!-- ì£¼ë¬¸ ë‚´ì—­ì´ ë¦¬ë·° ê´€ë¦¬ë³´ë‹¤ ë¨¼ì € ë‚˜ì™€ì•¼ í¸í•˜ì§€ ì•Šì„ê¹Œ? -->
        <!-- ì£¼ë¬¸ ë‚´ì—­ ê´€ë¦¬ë¥¼ ë§ˆì´í˜ì´ì§€ì—ì„œ í•  ê±°ë©´ -->
        <!-- ë§ˆì´í˜ì´ì§€ì—ì„œ ì£¼ë¬¸ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ê³  ì£¼ë¬¸ ëë‚˜ê³  ì•Œë ¤ì£¼ê¸°ë¼ë„ í•´ì•¼ ë  ë“¯ í•¨. -->
        <div class="user-order">
            <div class="user-order-text">
                <h2> ì£¼ë¬¸ ë‚´ì—­ </h2>
                <div class="info-more"><a href="{% url 'order_all' user_pk=user.pk %}"><button>ë”ë³´ê¸°</button></a></div>
                <!-- ì£¼ë¬¸ ë‚´ì—­ ì „ì²´ í˜ì´ì§€ êµ¬í˜„ í•„ìš” -->
            </div>
            <div class="order-info">
                <table style="width:100%">
                    <tr>
                        <th>ì£¼ë¬¸ ë²ˆí˜¸</th>
                        <th>ì¼€ì´í¬ ì‚¬ì§„</th>
                        <th>ê°€ê²Œ ì´ë¦„</th>
                        <th>ì§„í–‰ ìƒíƒœ</th> <!--ì§„í–‰ìƒíƒœ ì˜ˆì‹œ: ê²°ì œì™„ë£Œ(is_paid=True), ì ‘ìˆ˜ì™„ë£Œ(is_accepted=True), í”½ì—…ì™„ë£Œ(is_active=False) -->
                        <th>ì£¼ë¬¸ ì¼ì‹œ</th>
                        <th>ë¦¬ë·° ì‘ì„±</th>
                    </tr>
                    {% for order in orders %}
                    <tr>
                        <!-- ìˆœì„œëŒ€ë¡œ ì£¼ë¬¸ë²ˆí˜¸, ì¼€ì´í¬ì‚¬ì§„, ê°€ê²Œì´ë¦„, ì§„í–‰ìƒíƒœ, ì£¼ë¬¸ì¼ì‹œ, ë¦¬ë·°ì‘ì„± -->
                        <td>{{order.pk}}</td>

                        <!-- ì´ë¯¸ì§€ë¥¼ ëˆ„ë¥´ë©´ ì£¼ë¬¸ ìƒì„¸ë¡œ ì´ë™í•¨. -->
                        <td><a href="{% url 'order_detail' order_pk=order.pk %}"><img src="{{order.referred_cake.cake_image.url}}" aria-label="ì£¼ë¬¸í•œ ì¼€ì´í¬"></a></td>
                        
                        <td>{{order.referred_store}}</td>

                        {% if order.is_paid %}
                        <td>ê²°ì œì™„ë£Œ</td>
                        {% else %}
                        <td>ê²°ì œë¯¸ì™„ë£Œ</td>
                        {% endif %}
                        
                        <td>{{ order.order }}{{order.pub_date}}</td>
                        
                        {% if not order.review %}
                        <td><a href="{% url 'review_page' pk=order.referred_cake_id orderpk=order.id %}">ë¦¬ë·° ì‘ì„±</a></td>
                        {% else %}
                        <td><a href="{% url 'review_edit' pk=order.pk %}">ë¦¬ë·° ìˆ˜ì •</a><br>
                            <a href="{% url 'review_delete' pk=order.pk %}">ë¦¬ë·° ì‚­ì œ</a></td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </table>
                <br><br>
                
            </div>
        </div>
        <div class="user-review">
            <h2> ë¦¬ë·° ê´€ë¦¬ </h2>
            <div class="review-info" >
                <!-- ë¦¬ë·° ìƒì„¸ë³´ê¸°, ìˆ˜ì •, ì‚­ì œ êµ¬í˜„ ì•„ì§ X -->
                <!-- ì¼€ìŒì´ë¯¸ì§€, ì¼€ì´í¬ì´ë¦„, ê°€ê²Œì´ë¦„, ë³„ì , í‰ê°€ë‚´ìš©(15ì ê¹Œì§€) -->
                <!-- ì´ë¯¸ì§€ì— ë¦¬ë·° ìì„¸íˆë³´ê¸° ë§í¬ ë‹¬ì•„ì•¼ í•¨. -->
                {% for review in reviews %}
                <div class="review-card">
                    <a href="#"><img src="{{review.review_img.url}}" aria-label="ì£¼ë¬¸í•œ ì¼€ì´í¬"></a>
                    <br>
                    <span>Cake: {{review.order.referred_cake}}</span>
                    <br>
                    <span>Store: {{review.order.referred_store}}</span>
                    <br>
                    <section>{{review.comment|slice:"15"}}</section>
                    <span class="fa fa-star fa-2x checked"></span>
                    <span class="fa fa-star fa-2x {% if review.rate > 1 %} checked {% endif %}"></span>
                    <span class="fa fa-star fa-2x {% if review.rate > 2 %} checked {% endif %}"></span>
                    <span class="fa fa-star fa-2x {% if review.rate > 3 %} checked {% endif %}"></span>
                    <span class="fa fa-star fa-2x {% if review.rate > 4 %} checked {% endif %}"></span>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="user-liked">
            <h2> ì°œí•œ</h2>

            <!-- ì¼€ì´í¬ -->
            <div class="liked-cakes">
                <div class="user-liked-text">
                    <h2>ì¼€ì´í¬</h2>
                    <a href=""><button>ë”ë³´ê¸°</button></a> 
                </div>
                <div class="liked-contents">
                    <!-- ìˆœì„œëŒ€ë¡œ ì¼€ì´í¬ ì´ë¯¸ì§€, ì¼€ì´í¬ì´ë¦„, ê°€ê²Œì´ë¦„, ë³¸ë¬¸ -->
                    {% for cake in liked_cakes %}
                    <div class="each-cake">
                        <a href="{% url 'cake_detail' pk=cake.pk %}"><img src="{{cake.cake_image.url}}" aria-label="ì¼€ì´í¬ ì´ë¯¸ì§€"></a>
                        <br>
                        <span>{{cake.cakename}}</span>
                        <br>
                        <span>store: {{cake.referred_store}}</span>
                        <section>ì„¤ëª…: {{cake.body|slice:"15"}}</section>
                    </div>
                    {% endfor %}
                </div>
                <!-- ë‚´ ì°œí•œ ì „ì²´ ë¦¬ìŠ¤íŠ¸ ë”ë³´ê¸° êµ¬í˜„ í•„ìš” -->
            </div>

            <!-- ê°€ê²Œ -->
            <div class="liked-stores">
                <div class="user-liked-text">
                    <h2>ê°€ê²Œ</h2>
                    <a href=""><button>ë”ë³´ê¸°</button></a> 
                </div>
                <div class="liked-contents">
                    <!-- ìˆœì„œëŒ€ë¡œ ê°€ê²Œì´ë¦„, ì´ë¯¸ì§€, ì¥ì†Œ, ë³¸ë¬¸ -->
                    {% for store in liked_stores %}
                    <div class="each-store">
                        <span>{{store.name}}</span>
                        <a href="{% url 'store_detail' pk=store.pk %}"><img src="{{store.store_image.url}}" aria-label="ê°€ê²Œ ì´ë¯¸ì§€"></a>
                        <span>{{store.location}}</span>
                        <section>{{store.text|slice:"15"}}</section>
                    </div>
                    {% endfor %}
                </div>
                <!-- ë‚´ ì°œí•œ ì „ì²´ ë¦¬ìŠ¤íŠ¸ ë”ë³´ê¸° êµ¬í˜„ í•„ìš” -->
            </div>
        </div>
    </div>
{% endif %}
</body>
</html>
